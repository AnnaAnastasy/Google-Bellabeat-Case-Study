---
title: "Bellabeat Case Study"
author: "Anna Balatska"
date: "2023-01-20"
output:
  html_document: default
---

## Business Task

Business task of this project is to analyze smart device usage data in order to gain insight into:
1. What are some trends in smart device usage? 
2. How could these trends apply to Bellabeat customers? 
3. How could these trends help influence Bellabeat marketing strategy.


## Data Source 

[This dataset](https://www.kaggle.com/datasets/arashnic/fitbit?resource=download) on FitBit Fitness Tracker Data is from Kaggle.


#### About dataset: 

Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring. Individual reports can be parsed by export session ID (column A) or timestamp (column B). Variation between output represents use of different types of Fitbit trackers and individual tracking behaviors / preferences.


## Setting up my Environment

#### Loading data sets and libraries

```{r library and data set, message=FALSE, warning=FALSE}
library(tidyverse)
library(ggplot2)
activity <- read_csv("dailyActivity_merged.csv")
sleep <- read_csv("sleepDay_merged.csv")
weight <- read_csv("weightLogInfo_merged.csv")
```


## Data Exploration

First, let's check column names and structure of data sets.

```{r review datasets}
colnames(activity)
colnames(sleep)
colnames(weight)
str(activity)
str(sleep)
str(weight)
```

There are 15 columns and 940 rows in the `activity` data set. Data contains different measurements of daily activity, as total steps, calories burnt, total distance passed and active minutes.

`Sleep` data set has information on total minutes in bed and total minutes asleep, as well as how many times a day a person slept. In total, data set has 5 columns and 413 rows.

And the last one `weight` data set has 8 columns and 67 rows. There are weights in kg and pounds and BMI index.

Let's see how many unique Ids we have, in other words, how many people are represented in the data sets.

```{r unique ids}
cat("'Activity' data set has", length(unique(activity$Id)), "unique Ids.")
cat("'Sleep' data set has", length(unique(sleep$Id)), "unique Ids.")
cat("'Weight' data set has", length(unique(weight$Id)), "unique Ids.")
```

Now, let's see for what period data was collected.

```{r dates}
min(activity$ActivityDate)
max(activity$ActivityDate)
min(sleep$SleepDay)
max(sleep$SleepDay)
min(weight$Date)
max(weight$Date)
```

We can see that there is data from April 12, 2016 until May 9, 2016 in all three data sets.

And what about summary for each column.

```{r summaries}
summary(activity)
summary(sleep)
summary(weight)
```

Interesting observations:

-   average steps taken: 7638
-   average sedentary time: 16.5 hours
-   lightly active minutes: 3.2 hours
-   fairly active and very active time on average 13.5 min and 21.1 min accordingly
-   average total time in bed: 7.6 hours
-   average total time asleep: 7 hours
-   maximum total time in bed: 16 hours (could be for an ill person)
-   average BMI is 25.19 (healthy BMI is considered from 18.5 to 24.9)
-   min and max BMI are 21 and 47 accordingly


## Limitations of Data

Reviewing this data set, I noticed two limitations. One is that it doesn't specify gender. We are doing this project for Bellabeat app, which is specifically designed for women, and here we have data from Fitbit with unknown gender. It could be all men or partially men, and this would be a strongly biased data. For this project we should be focused on the performance of women only. There is a [discussion](https://www.kaggle.com/datasets/arashnic/fitbit/discussion/289024?search=women) on Kaggle on this topic, if you want to read more.

And the second limitation is that we have records on very few people, it's not enough to make any conclusions about population (for example, population of those who are using fitness trackers).

Nevertheless, I decided to keep going with this project and this data set as it's for educational purpose only. In statistics, there is a term [convenience sampling](https://www.questionpro.com/blog/convenience-sampling/). This type of sampling is usually highly biased and shouldn't be used, unless only low risk circumstances are involved, like in our case. In real world, I would search for more credible data.


## Data Cleaning

#### Fixing Formatting

The date columns are in string format. Let's fix it. And as well, let's rename these columns the same.

```{r convert date columns}
activity$Date <- as.POSIXct(activity$ActivityDate, format = "%m/%d/%Y")
sleep$Date <- as.POSIXct(sleep$SleepDay, format = "%m/%d/%Y")
weight$Date <- as.POSIXct(weight$Date, format = "%m/%d/%Y")
```

And then drop old columns that were replaced by new ones.

```{r drop columns}
sleep <- select(sleep, -SleepDay)
activity <- select(activity, -ActivityDate)
```


#### Removing Duplicates

First, let's check if there is any duplicated row.

```{r check for duplicates}
sum(duplicated(activity))
sum(duplicated(sleep))
sum(duplicated(weight))
```

There are 3 duplicated rows in `sleep` data set. Let's drop them.

```{r remove duplicates}
sleep <- sleep %>%
  distinct() %>%
  drop_na()
```


#### Cleaning Null values

Let's see if there is any null value. Function `complete.cases` counts rows that don't have any null values and function `nrow` counts total amount of rows in a data set. If they return the same number, it means there is no nulls in the data set. If the returned numbers differ, further exploration is needed.

```{r check for nulls}
sum(complete.cases(activity))
nrow(activity)
sum(complete.cases(sleep))
nrow(sleep)
sum(complete.cases(weight))
nrow(weight)
```

The `weight` data set has only two complete rows out 67. Let'explore it.

```{r print first 6 rows of weight df}
head(weight)
```

It looks like the problem is with a column `Fat`. I will print all the values from the column.

```{r print column fat}
weight$Fat
```

Right, it has only two non-null values. Let's drop this column.

```{r drop column fat and check for more nulls}
weight <- select(weight, -Fat)
sum(complete.cases(weight))
nrow(weight)
```

Great, there is no more null values! We can move on to data transformation.


## Data Transformation

#### Turning Minutes into Hours

First of all, I want to turn minutes into hours in `sleep` data set to easier analyze it.

```{r turn minutes to hours}
sleep2 <- sleep %>%
  mutate(
    TotalHoursAsleep = round(sleep$TotalMinutesAsleep / 60, 1),
    TotalHoursInBed = round(sleep$TotalTimeInBed / 60, 1)
  )

head(sleep2)
```


#### Merging Data

In order to visualize correlations between variable in different data sets later, I will merge data now. As all of the data sets have different amount of rows, merging them all together will mean loosing huge amount of rows. So I will merge two at a time.

```{r merge data sets}
activity_sleep <- merge(activity, sleep, by = c("Id", "Date"))
activity_weight <- merge(activity, weight, by = c("Id", "Date"))
sleep_weight <- merge(sleep, weight, by = c('Id', 'Date'))

cat("'activity_sleep' dataset has", n_distinct(activity_sleep$Id), "unique Ids and", n_distinct(activity_sleep$Date), "unique dates.\n")

cat("'activity_weight' dataset has", n_distinct(activity_weight$Id), "unique Ids and", n_distinct(activity_weight$Date), "unique dates.\n")

cat("'sleep_weight' dataset has", n_distinct(sleep_weight$Id), "unique Ids and", n_distinct(sleep_weight$Date), "unique dates")
```


#### Creating new Table with Average Steps per Weekday

To have a table with average steps by all of the participants per each day of a week, first, I will turn dates into days of week and then I will calculate average number of steps.

```{r steps per weekday}
weekday_activity <- activity %>%
  mutate(Weekday = weekdays(Date))

weekday_activity$Weekday <- ordered(weekday_activity$Weekday, levels = c("Monday", "Tuesday", "Wednesday", "Thursday",
"Friday", "Saturday", "Sunday"))

weekday_avg_steps <- weekday_activity %>%
    group_by(Weekday) %>%
        summarize (DailySteps = mean(TotalSteps))

head(weekday_avg_steps)
```


#### Creating new Table with Average Sleep Time per Weekday

Now, I will do the same with hours asleep.

```{r sleep time per weekday}
weekday_sleep <- sleep2 %>%
  mutate(Weekday = weekdays(Date))

weekday_sleep$Weekday <- ordered(weekday_sleep$Weekday, levels = c("Monday", "Tuesday", "Wednesday", "Thursday",
"Friday", "Saturday", "Sunday"))

weekday_avg_sleep <- weekday_sleep %>%
    group_by(Weekday) %>%
        summarize(DailySleep = mean(TotalHoursAsleep))

head(weekday_avg_sleep)
```


## Data Visualization

#### Visualizing Total Steps

First of all, we will look at the distribution of number of steps taken a day.

```{r distribution steps}
ggplot(data = activity) +
    geom_histogram(mapping = aes(x = TotalSteps, color = "red", fill = 'red'), 
                   binwidth = 4000, alpha = 0.9, show.legend = FALSE) +
    geom_vline(aes(xintercept=10000), linetype="dashed", color = "darkred") +
    labs(x = "daily steps", title = "Distribution of number of steps") +
    theme_classic()
```

Recommendation of 10,000 steps is widely known and most of the participants in this study don't reach it but the [latest research](%22https://www.nbcnews.com/health/health-news/how-many-steps-day-should-you-take-study-finds-7-n1278853%22) suggests that there is no need to walk 10,000 or more steps a day. Yes, people gain more health benefits the more steps they took, but the greatest statistically significant reduction in mortality risk appeared to be between 7,000 and 10,000 steps.

Here we can see a positive correlation below 10,000, in other words, there is more people who walk close to 10 thousand steps (e.g. 9000 steps) compared to the ones who walk 5 thousand and even more than those who walk 2 thousand. It looks fine, but still let's find out what percentage of records is in the recommended range.

```{r count percentage}
less_7000 <- sum(activity$TotalSteps < 7000) / length(activity$TotalSteps) * 100
between_7000_10000 <- sum(activity$TotalSteps >= 7000 & activity$TotalSteps < 10000) / length(activity$TotalSteps) * 100
more_10000 <- sum(activity$TotalSteps >= 10000) / length(activity$TotalSteps) * 100

data <- matrix(c(less_7000, between_7000_10000, more_10000), nrow=3, ncol=1)
rownames(data) <- c('Less than 7,000 steps','7,000-10,000 steps','More than 10,000 steps')
colnames(data) <- "Percentage" 
final=as.table(data)
print(final)
```

```{r bar plot}
activity2 <- activity %>%
    mutate(
        TotalSteps = case_when(
            activity$TotalSteps < 7000 ~ "0-7,000",
            activity$TotalSteps >= 7000 &
                activity$TotalSteps < 10000 ~ "7,000-10,000",
            activity$TotalSteps >= 10000 ~ "More than 10,000"
        ))

ggplot(data = activity2, aes(x = TotalSteps, color = TotalSteps, fill = TotalSteps)) +
    geom_bar(alpha = 0.9, show.legend = FALSE) +
    labs(x = "total steps", title = "All steps records divided into 3 groups") +
    theme_classic()
```

Now, we can clearly see that almost half of the records are below 7,000 steps! And only 21.3% of records are between 7 and 10 thousand steps. That definitely needs some improvement.


#### Analyzing BMI

Now, let's move on to the body mass index. BMI is a value derived from the mass and height of a person. According to [World Health Organization](%22https://www.who.int/europe/news-room/fact-sheets/item/a-healthy-lifestyle---who-recommendations%22):

-   If your BMI is less than 18.5, it falls within the underweight range.
-   If your BMI is 18.5 to 24.9, it falls within the Healthy Weight range.
-   If your BMI is 25.0 to 29.9, it falls within the overweight range.
-   If your BMI is 30.0 or higher, it falls within the obese range.

```{r histogram of bmi}
ggplot(data = weight) +
    geom_histogram(mapping = aes(x = BMI, color = "red", fill = "red"), 
                   bins = 25, alpha = 0.9, show.legend = FALSE) +
    labs(title = "Distribution of Body Mass Index records") +
    theme_classic()
```

We have one outlier with BMI more than 40 and the rest falls into category with index between 20 and 30. But there is one problem with this histogram. As you might remember we have only 8 people in the `weight` data set and the distribution shows all records by these 8 people during less than one month. It can be highly skewed by people who record their weight often. It has very low probability that BMI of any person can change significantly during 1 month, so we will count only average body mass index per participant.

```{r count mean bmi}
weight_grouped <- weight %>%
    group_by(Id) %>%
    summarise(BMI = mean(BMI))
```

Next, we will group people by category.

```{r divide by category}
weight_grouped2 <- weight_grouped %>%
    mutate(
        BMI = case_when(
            weight_grouped$BMI < 18.5 ~ "Underweight",
            weight_grouped$BMI >= 18.5 &
                weight_grouped$BMI < 25 ~ "Healthy Weight",
            weight_grouped$BMI >= 25 &
                weight_grouped$BMI < 30 ~ "Overweight",
            weight_grouped$BMI >= 30 ~ "Obese"
        ))
```

And, finally, create a bar chart. I use `fct_relevel` to put categories in the correct order and `scale_fill_manual` to change colors to more intuitive ones (green for healthy, orange for overweight and red for obese).

```{r barchart bmi}
library(forcats)

ggplot(data = weight_grouped2, aes(x = fct_relevel(BMI, "Overweight", after = 1), fill = fct_relevel(BMI, "Overweight", after = 1))) +
    geom_bar(alpha = 0.7, show.legend = FALSE) +
    labs(title = "Participants categorized by Body Mass Index", x = "BMI category") +
    scale_fill_manual(values=c("darkgreen", "orange", "red")) +
    theme_classic()
```

So, we can see that in our small sample we don't have anyone in underweight range (as you might have noticed from the distribution above, as well), there are 3 people in healthy weight, 4 people in overweight and 1 in obese range.


#### Visualizing Sleep Patterns

Let's move on to analyze sleep patterns of our participants.

```{r histogram of sleeping}
ggplot(data = sleep2) +
    geom_histogram(mapping = aes(x = TotalHoursAsleep, fill = 'red', color = 'red'), 
                   bins = 25, alpha = 0.9, show.legend = FALSE) +
    labs(title = "Distribution of sleep records", x = 'hours asleep') +
    theme_classic()
```

Sleep records have standard normal distribution with highest frequency in the range from 5.5 to 9 hours a day. But as well, we see disturbing amount of records that are less than 5 hours.

According to [National Sleep Foundation guidelines]('https://pubmed.ncbi.nlm.nih.gov/29073412/') healthy adults need between 7 and 9 hours of sleep per night. Babies, young children, and teens need even more sleep to enable their growth and development. People over 65 should also get 7 to 8 hours per night.

I will calculate average amount of sleep per participant and divide them into categories, according to National Sleep Foundation guidelines. And let's suppose that we have only adults younger than 65 in our study.

```{r count mean sleep time}
sleep_grouped <- sleep2 %>%
    group_by(Id) %>%
    summarise(AveHoursAsleep = mean(TotalHoursAsleep))
```

```{r divide sleep by category}
sleep_grouped2 <- sleep_grouped %>%
    mutate(
        AverageHoursAsleep = case_when(
            sleep_grouped$AveHoursAsleep < 7 ~ "Too Little",
            sleep_grouped$AveHoursAsleep  >= 7 &
                sleep_grouped$AveHoursAsleep  <= 9 ~ "Healthy Sleep",
            sleep_grouped$AveHoursAsleep  > 9 ~ "Too Much"
        ))
```

```{r barchart sleep}
ggplot(data = sleep_grouped2, aes(x = fct_relevel(AverageHoursAsleep, "Healthy Sleep", after = 1), fill = fct_relevel(AverageHoursAsleep, "Healthy Sleep", after = 1))) +
    geom_bar(alpha = 0.9, show.legend = FALSE) +
    labs(title = "Amount of sleep each participant gets on average", x = "") +
    theme_classic()
```

Most of the participants don't sleep enough (less than 7 hours a day) and some sleep too much (more than 9 hours a day).


#### Visualization of Steps depending on a Day of a Week

Next, I will visualize average steps taken per day of a week for everyone in our sample together.

```{r visualize steps per weekday}
ggplot(weekday_avg_steps, aes(x = Weekday, y = DailySteps)) +
      geom_bar(stat = 'identity', color = '#007702', fill = "#007702", alpha = 0.7) +
      labs(title = "Average steps per weekday", x= "", y = "") +
    theme_classic()
```

It looks like there is slightly more activity (more steps taken) on Tuesdays and Saturdays, while on Sundays people tend to walk less and probably rest more.


#### Visualization of Hours Asleep depending on a Day of a Week

Now, I will do the same with hours asleep.

```{r visulize sleep per weekday}
ggplot(weekday_avg_sleep, aes(Weekday, DailySleep)) +
      geom_bar(stat = 'identity', fill='#CD022D', color = '#CD022D', alpha = 0.7) +
      labs(title = "Average hours asleep per weekday", x= "", y = "") +
      theme_classic()
```

Here we see that on Sundays and Wednesdays participants tend to sleep more.


#### Visualizing Correlation between Calories and Total Steps

```{r scatter calories vs steps}
ggplot(data = activity, aes(x = TotalSteps, y = Calories)) +
  geom_point(color = '#003D30') +
  geom_smooth(method = 'loess', formula = 'y ~ x', color = '#009175') +
  labs(title = "Total steps vs calories", y = 'calories', x = 'total steps') +
  theme_classic()
```

There is a positive correlation, meaning that higher numbers of steps are associated with higher amounts of calories burnt.


#### Visualizing Correlation between Sedentary Minutes and Total Minutes Asleep

```{r scatter sedentary vs asleep}
ggplot(data = activity_sleep, aes(x = SedentaryMinutes, y = TotalMinutesAsleep)) +
  geom_point(color = '#00306F') +
  geom_smooth(method = 'loess', formula = 'y ~ x', color = '#005FCC') +
  labs(title = "Sedentary minutes vs total minutes asleep", x = 'sedentary minutes', y = 'minutes asleep') +
  theme_classic()
```

Here we can see a negative correlation, meaning that more sedentary minutes are associated with less total minutes asleep.


#### Visualizing Correlation between Time in the Bed and Time Asleep

```{r scatter in bed vs asleep}
ggplot(data = sleep, aes(x = TotalTimeInBed, y = TotalMinutesAsleep)) +
  geom_point(color = '#450270') +
  geom_smooth(method = 'loess', formula = 'y ~ x', color = '#8400CD') +
  labs(title = "Total time in bed vs total time asleep", x = 'minutes in bed', y = 'minutes asleep') +
  theme_classic()
```

Here, there is a pretty strong positive correlation. It makes sense. Time you sleep is correlated with the time you spend in the bed. But does it mean that more time spent in bed helps (in other words, causes) you to sleep more? Unfortunately, this data is not enough to answer this question.


## Conclusions

Recommendations for `Bellabeat` app made based on analysis of `Fitbit` data:

* Many people walk less than 7000 steps (46.5% of our sample). So I recommend to put an emphasis on this number. 10 thousand might feel too intimidating for some people, while 7 thousand steps sounds more reachable and according to the latest studies, it's enough for health benefits.
* Most of the users in our sample sleep too little. Providing reminders to go to sleep earlier could be helpful.
* For users who don't reach their daily goals of sleep and steps, I recommend sending personalized emails about positive effect that activity makes on a sleep. But for this, more research should be done, as in our analysis we stated association between variables, not causation.
* As Sundays tend to be less active for most of the people in our sample, some soft motivation could be helpful. By soft motivation I mean let people sleep and rest on this day (as they anyway will do), decrease step goals but still send few reminders to go out, take relaxing pleasant walks and enjoy their Sunday.


### Thank you for your time! 
#### Feel free to ask me anything, if you have any doubts.